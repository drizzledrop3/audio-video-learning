# FFmpeg学习

## 命令行

### 常用参数

#### -i

在FFmpeg中，"-i"参数用于**指定输入文件或输入流**。它是一个**必需的参数**，表示输入文件或流的位置和类型。该参数后面应该**跟着输入文件或流的路径或URL**。

例如，假设我们要**转换**一个名为"input.mp4"的**视频文件为另一个格式**，我们可以使用以下命令：

```cmd
ffmpeg -i input.avi output.mp4
```

"-i"参数用于指定输入文件"input.mp4"，而"output.avi"则是转换后的输出文件。请注意，如果**输入文件的路径或名称中包含空格或其他特殊字符，应该<u>使用引号将其括起来</u>**。



此外，"-i"参数也可以用于**指定从输入流中读取数据**。例如，我们可以使用以下命令**从网络摄像头中捕获视频流**：

```cmd
ffmpeg -i rtsp://192.168.1.1/stream output.mp4
```

在这个命令中，"-i"参数指定从网络摄像头的RTSP流中读取数据，并将其保存为"output.mp4"文件。

简而言之，"-i"参数是FFmpeg中非常重要的一个参数，它**用于指定输入文件或流，是使用FFmpeg进行音视频处理的<u>必需参数</u>**。





#### -f

在FFmpeg中，"-f"参数用于**指定输出格式**。它是一个**可选参数**，如果不指定，则<u>FFmpeg将根据输出文件的扩展名猜测输出格式</u>。

例如，假设我们要将一个名为"input.mp4"的视频文件转换为"output.avi"格式，我们可以使用以下命令：

```cmd
ffmpeg -i input.mp4 -f avi output.avi
```

在这个命令中，"-i"参数用于指定输入文件"input.mp4"，而"-f"参数则用于指定输出格式为"avi"，"output.avi"是转换后的输出文件。

请注意，不是所有的格式都能够被FFmpeg所支持。如果你不确定输出格式的类型或参数，可以使用"ffmpeg -formats"命令列出所有可用的输出格式。

除了"-f"参数外，还有一些其他的输出参数可以进行配置，例如"-b:v"、"-s"、"-r"等，这些参数可以对输出文件的比特率、分辨率、帧率等进行配置。

简而言之，"-f"参数是FFmpeg中用于**指定输出格式的一个可选参数，它可以帮助我们控制输出文件的格式和类型**。





#### -b:v

在FFmpeg中，"-b:v"参数用于**指定输出视频的比特率**。它是一个**可选参数**，用于<u>控制输出视频文件的码率</u>，也就是视频数据每秒钟的平均比特数。该参数的值可以是固定比特率（如10M）或变量比特率（如2000k）。

例如，假设我们要将一个名为"input.mp4"的视频文件转换为"output.avi"格式，并将输出文件的比特率设置为2Mbps，我们可以使用以下命令：

```cmd
ffmpeg -i input.mp4 -b:v 2M output.avi
```

在这个命令中，"-i"参数用于指定输入文件"input.mp4"，而"-b:v"参数则用于**指定输出视频的比特率为2Mbps**，"output.avi"是转换后的输出文件。

请注意，输出文件的比特率并不是越高越好。**过高**的比特率可能会导致**文件过大、上传下载缓慢、播放卡顿**等问题，而**过低**的比特率则可能导致**视频质量下降、画面模糊**等问题。因此，应该根据具体的需求和情况，选择合适的比特率。

除了"-b:v"参数外，还有一些其他的输出参数可以进行配置，例如"-s"、"-r"、"-c:v"等，这些参数可以对输出文件的分辨率、帧率、编码格式等进行配置。

简而言之，"-b:v"参数是FFmpeg中用于**指定输出视频比特率的一个可选参数，它可以帮助我们控制输出视频文件的码率和文件大小**。





#### -bufsize

在FFmpeg中，"-bufsize"参数用于**设置视频编码器缓冲区的大小，以控制输出视频的码率和视频质量**。该参数是一个**可选参数**，单位为比特数（bit）。

视频编码器将输入视频的原始数据进行编码，生成压缩后的视频数据。**编码器缓冲区是编码器在编码过程中用来存储数据的区域，当缓冲区中的数据达到一定数量时，编码器才会将数据写入输出文件。通过设置缓冲区大小，可以控制编码器输出数据的速度和质量**。

例如，假设我们要将一个名为"input.mp4"的视频文件转换为"output.avi"格式，并设置输出视频的比特率为2Mbps，缓冲区大小为2M，我们可以使用以下命令：

```cmd
ffmpeg -i input.mp4 -b:v 2M -bufsize 2M output.avi
```

在这个命令中，"-i"参数用于指定输入文件"input.mp4"，"-b:v"参数用于指定输出视频的比特率为2Mbps，而"-bufsize"参数则用于设置视频编码器缓冲区的大小为2M，"output.avi"是转换后的输出文件。

请注意，如果缓冲区大小设置得**过小**，则可能会导致**视频质量下降或出现卡顿**等问题；如果设置得**过大**，则可能会导致**编码器延迟增加、处理速度变慢**等问题。因此，应该根据具体的需求和情况，选择合适的缓冲区大小。

除了"-bufsize"参数外，还有一些其他的输出参数可以进行配置，例如"-s"、"-r"、"-b:a"等，这些参数可以对输出文件的分辨率、帧率、音频比特率等进行配置。

简而言之，"-bufsize"参数是FFmpeg中用于设置视频编码器缓冲区大小的一个可选参数，它可以帮助我们控制输出视频的码率和质量。

>  **注：**
>
>  在FFmpeg中，**当使用"-b:v"参数指定输出视频的比特率时，建议同时使用"-bufsize"参数设置视频编码器缓冲区的大小，并且两个参数的值一般应该相同**。这是因为：
>
>  1. 视频编码器需要在缓冲区中积累一定数量的数据才能进行编码，如果缓冲区太小，可能导致编码器无法及时处理输入数据，从而影响输出视频的质量。
>  2. 输出视频的比特率和视频编码器缓冲区的大小密切相关。如果输出视频的比特率较高，但缓冲区太小，可能会导致缓冲区溢出，从而导致数据丢失或视频质量下降。相反，如果输出视频的比特率较低，但缓冲区太大，可能会导致编码器延迟增加，从而影响输出视频的处理速度和质量。
>
>  因此，建议在使用"-b:v"参数时，同时使用"-bufsize"参数，并将它们的值设置为相同的大小。这样可以**确保视频编码器有足够的缓冲区来存储输入数据，并在输出视频的质量和处理速度之间取得一个平衡**。
>
>  需要注意的是，缓冲区大小的设置还受到其他因素的影响，例如视频分辨率、帧率、编码格式等。因此，应该根据具体的需求和情况，选择合适的缓冲区大小。





#### 	-r

在FFmpeg中，"-r"参数可以用于**指定输入视频的帧率和输出视频的帧率**。该参数是一个**可选参数**，单位是帧率。如果在输入视频时使用"-r"参数，则指定输入视频的帧率；如果在输出视频时使用"-r"参数，则指定输出视频的帧率。

例如，以下命令可以将名为"input.mp4"的视频文件转换为"output.avi"格式，并将输出视频的帧率设置为25fps：	

```cmd
ffmpeg -i input.mp4 -r 25 output.avi
```

在这个命令中，"-i"参数用于指定输入文件"input.mp4"，而"-r"参数用于设置输出视频的帧率为25fps。

如果要指定输入视频的帧率，则可以使用以下命令：

```cmd
ffmpeg -r 25 -i input.mp4 output.avi
```

在这个命令中，"-r"参数用于指定输入视频的帧率为25fps，"-i"参数用于指定输入文件"input.mp4"，而"output.avi"是转换后的输出文件。

需要注意的是，输入视频的帧率和输出视频的帧率应该相匹配，否则可能会导致视频播放速度变快或变慢，甚至出现视频画面断层的问题。因此，在使用"-r"参数时，应该**确保与输入视频的帧率或者输出视频的帧率相同，并根据实际需求进行调整**。





#### -s

在FFmpeg中，"-s"参数用于**设置输出视频的分辨率**，该参数是一个**可选参数**。

例如，如果要将名为"input.mp4"的视频文件转换为"output.avi"格式，并将输出视频的分辨率设置为640x480，可以使用以下命令：

```cmd
ffmpeg -i input.mp4 -s 640x480 output.avi
```

在这个命令中，"-i"参数用于指定输入文件"input.mp4"，而"-s"参数用于设置输出视频的分辨率为640x480，"output.avi"是转换后的输出文件。

需要注意的是，**分辨率的大小会影响视频的清晰度和文件大小，分辨率越高，视频越清晰，文件大小也越大**。在使用"-s"参数时，应该根据实际需求进行调整。

除了"-s"参数外，还有一些其他的输出参数可以进行配置，例如"-r"、"-b:v"、"-bufsize"等，这些参数可以对输出文件的帧率、比特率、缓冲区大小等进行配置。

简而言之，"-s"参数是FFmpeg中用于设置输出视频的分辨率的一个重要参数，它可以**帮助我们控制输出视频的清晰度和文件大小。在使用该参数时，应该根据实际需求进行调整。**





#### -c:v

在FFmpeg中，"-c:v"参数用于**设置视频编解码器**（Video Codec），该参数是一个**可选参数**。它**指定了用于编码输出视频的编解码器**。编解码器是一种能够将视频压缩为较小文件大小的算法，同时保持视频质量的方法。

在FFmpeg中，有许多不同的视频编解码器可供选择，例如H.264、MPEG-4、VP8、VP9等等。在使用"-c:v"参数时，需要输入所需的编解码器名称或者ID。可以通过"-encoders"命令查看所有可用的视频编解码器，例如：

```cmd
ffmpeg -encoders | findstr video
```



例如，如果要将名为"input.mp4"的视频文件转换为"output.avi"格式，并**将输出视频的编码器设置为MPEG-4**（使用libxvid编解码器），可以使用以下命令：

```cmd
ffmpeg -i input.mp4 -c:v libxvid -q:v 3 output.avi
```

在这个命令中，"-i"参数用于指定输入文件"input.mp4"，而**"-c:v"参数用于设置输出视频的编码器为MPEG-4，使用libxvid编解码器。"-q:v"参数用于设置输出视频的质量，数字越小质量越高，3是一个常见的中等质量值**。"output.avi"是转换后的输出文件。

需要注意的是，不同的编码器具有不同的特点和性能，而且它们也可能具有不同的版权和许可证要求。因此，在选择编码器时，应该根据实际需求和考虑其他方面的因素进行选择。如果不指定编码器，则FFmpeg会**根据输出文件的扩展名自动选择一个默认编码器**。

除了"-c:v"参数外，还有一些其他的编解码器参数可以进行配置，例如"-b:v"、"-bufsize"、"-preset"等，这些参数可以对输出视频的比特率、缓冲区大小、编码速度等进行配置。

简而言之，"-c:v"参数是FFmpeg中用于**设置输出视频编解码器的一个重要参数，它可以帮助我们选择合适的编解码器来实现视频的压缩和保证视频质量**。在使用该参数时，应该根据实际需求进行调整。



#### -c:a

在FFmpeg中，"-c:a"参数是用于设置输出音频编解码器的参数，该参数是一个**可选参数**。它可以指定输出文件的音频编码器，让FFmpeg将输入音频流从一种格式转换为另一种格式。

在使用该参数时，需要输入所需的音频编解码器名称或者ID。可以通过"-encoders"命令查看所有可用的音频编解码器，例如：

```cmd
ffmpeg -encoders | findstr audio
```



举个例子，如果要将名为"input.mp3"的音频文件转换为"output.ogg"格式，并使用vorbis编解码器进行编码，可以使用以下命令：

```cmd
ffmpeg -i input.mp3 -c:a libvorbis output.ogg
```

在这个命令中，"-i"参数用于指定输入文件"input.mp3"，而"-c:a"参数用于设置输出音频的编码器为vorbis，使用libvorbis编解码器。"output.ogg"是转换后的输出文件。

除了"-c:a"参数外，还有一些其他的音频编解码器参数可以进行配置，例如"-b:a"、"-ar"、"-ac"等，这些参数可以对输出音频的比特率、采样率、声道数等进行配置。

需要注意的是，不同的音频编解码器具有不同的特点和性能，而且它们也可能具有不同的版权和许可证要求。因此，在选择编码器时，应该根据实际需求和考虑其他方面的因素进行选择。如果不指定编码器，则FFmpeg会根据输出文件的扩展名自动选择一个默认编码器。

简而言之，"-c:a"参数是FFmpeg中用于**设置输出音频编解码器的一个重要参数，它可以帮助我们选择合适的编解码器来实现音频的压缩和保证音频质量**。在使用该参数时，应该根据实际需求进行调整。





#### -vf

在 FFmpeg 中，-vf（video filter）参数用于指定视频过滤器。通过使用-vf参数，可以将多个过滤器以逗号分隔的形式串联在一起。过滤器可以用于修改视频的帧率、大小、格式等属性，或者应用各种效果和滤镜来增强视频的质量。

> 注:
>
> 在使用 FFmpeg 进行视频处理时，可以使用 `-filter_complex` 或 `-vf` 参数来指定视频过滤器。这两个参数的作用是一样的，都用于指定视频过滤器，写法不同。
>
> `-vf` 参数用于指定简单的线性滤镜链，适用于只有一种输入和输出的情况。例如，下面的命令将视频裁剪到宽度为 100 像素：
>
> ```
> cssCopy code
> ffmpeg -i input.mp4 -vf crop=100:in_h output.mp4
> ```
>
> `-filter_complex` 参数用于指定复杂的过滤器图形，适用于多输入和多输出的情况。例如，下面的命令将两个视频拼接在一起：
>
> ```
> lessCopy code
> ffmpeg -i input1.mp4 -i input2.mp4 -filter_complex "[0:v] [0:a] [1:v] [1:a] concat=n=2:v=1:a=1 [v] [a]" -map "[v]" -map "[a]" output.mp4
> ```
>
> 虽然 `-vf` 和 `-filter_complex` 的作用是一样的，但是 `-vf` 的使用比较简单，适用于只有一种输入和输出的情况，而 `-filter_complex` 则适用于多输入和多输出的情况。





#### -ac

在FFmpeg中，"-ac"参数用于**设置输出音频流的声道数的参数**，该参数是一个**可选参数**。它可以指定输出文件的声道数，从而使FFmpeg将输入音频流从一种声道数转换为另一种声道数。

在使用该参数时，需要输入所需的声道数，可以是一个整数，也可以是一个特定的声道布局。例如，"-ac 2"表示输出文件应该是双声道的，"-ac 1"表示输出文件应该是单声道的。如果要将多声道音频流转换为单声道音频流，可以使用以下命令：

```cmd
ffmpeg -i input.wav -ac 1 output.wav
```

在这个命令中，"-i"参数用于指定输入文件"input.wav"，而"-ac"参数用于设置输出音频流的声道数为1，也就是单声道。"output.wav"是转换后的输出文件。

需要注意的是，"-ac"参数只是用于设置输出文件的声道数，不同的声道数可能会影响音频的质量和大小。在进行音频转换时，应该根据实际需求和其他因素进行选择。如果不指定"-ac"参数，则FFmpeg会使用默认的声道数进行转换，一般情况下默认值为输入音频流的声道数。

简而言之，"-ac"参数是FFmpeg中用于设置输出音频流声道数的一个重要参数，它可以帮助我们**实现音频流的格式转换和声道数调整**。在使用该参数时，应该根据实际需求进行调整。





#### -ar

在FFmpeg中，"-ar"参数用于**设置输出音频流的采样率的参数**，该参数是一个**可选参数**。采样率是指在一定时间内对声音信号进行采样的次数，采样率越高，声音的还原效果就越好，但是文件大小也会相应增加。

在使用该参数时，需要输入所需的采样率，可以是一个整数。例如，"-ar 44100"表示输出文件应该有44.1kHz的采样率，这是CD音频标准的采样率。如果要将输入文件的采样率降低到22050Hz，可以使用以下命令：

```cmd
ffmpeg -i input.wav -ar 22050 output.wav
```

在这个命令中，"-i"参数用于指定输入文件"input.wav"，而"-ar"参数用于设置输出音频流的采样率为22050Hz，也就是将采样率降低到一半。"output.wav"是转换后的输出文件。

需要注意的是，"-ar"参数只是用于设置输出文件的采样率，不同的采样率可能会影响音频的质量和大小。在进行音频转换时，应该根据实际需求和其他因素进行选择。如果不指定"-ar"参数，则FFmpeg会使用默认的采样率进行转换，一般情况下**默认值为输入音频流的采样率**。

简而言之，"-ar"参数是FFmpeg中用于**设置输出音频流采样率**的一个重要参数，它可以帮助我们实现音频流的格式转换和采样率调整。在使用该参数时，应该根据实际需求进行调整。





#### -filter_complex

在FFmpeg中，"-filter_complex"参数用于**应用复杂滤镜**的参数。在视频编辑和处理过程中，滤镜是非常重要的工具，它可以帮助我们**实现各种特效和效果**。在FFmpeg中，滤镜可以应用于音频、视频或复合流，而"-filter_complex"参数则是用于应用复杂滤镜的场景。

复杂滤镜是由多个简单滤镜组合而成的滤镜，它可以实现更加复杂的特效和处理效果。在使用"-filter_complex"参数时，需要使用一些特殊的语法来描述滤镜的结构和参数，例如：

```cmd
ffmpeg -i input.mp4 -filter_complex "[0:v]scale=640x360,transpose=1[v];[0:a]volume=2.0[a]" -map "[v]" -map "[a]" output.mp4
```

在这个命令中，"-i"参数用于指定输入文件"input.mp4"，而"-filter_complex"参数用于应用复杂滤镜。在这个滤镜中，**输入文件的视频流通过"scale"滤镜进行缩放，然后通过"transpose"滤镜进行旋转。音频流则通过"volume"滤镜进行音量调整**。最后，"-map"参数用于指定输出文件中需要包含哪些流，这里将视频流和音频流分别映射到了输出文件的"v"和"a"标签中。

需要注意的是，复杂滤镜的语法和参数比较复杂，需要掌握一定的FFmpeg知识和滤镜语法。在实际使用中，可以参考官方文档和其他资料，或者查看FFmpeg提供的示例代码。同时，也可以通过多次实践和调试来掌握复杂滤镜的使用方法和技巧。



#### -q:a

在FFmpeg中，`-q:a`参数用于指定音频的质量，取值范围为0到9，其中0为最高质量，9为最低质量。这个参数只在一些编码器（如libmp3lame、libopus、libvorbis）下起作用。

具体地说，这个参数会影响编码器的比特率控制。通常情况下，比特率越高，音频质量越好，但文件大小也越大。如果使用`-q:a`参数，编码器将会根据所指定的质量级别自动选择合适的比特率来进行编码，从而在一定程度上平衡音频质量和文件大小。

需要注意的是，不同编码器对`-q:a`参数的解释可能会有所不同，因此在使用时应该查看具体编码器的文档或者测试不同参数值所得到的音频质量和文件大小，以便选择最适合的参数。





#### -preset

在FFmpeg中，"-preset"参数用于**指定编码速度和质量之间平衡的参数**。在视频编码的过程中，编码速度和编码质量之间往往存在着一定的平衡关系，如果希望提高编码速度，可能会牺牲一定的编码质量；反之亦然。而"-preset"参数则是用于控制这种平衡的关键参数之一。

具体来说，"-preset"参数会影响到编码器的多个参数和设置，从而影响编码速度和质量。在FFmpeg中，常见的"-preset"参数包括：

- ultrafast
- superfast
- veryfast
- faster
- fast
- medium
- slow
- slower
- veryslow

这些参数分别代表了编码速度和质量的不同权衡关系。一般来说，速度越快，编码质量可能会越差；速度越慢，编码质量可能会越好。具体选择哪个"-preset"参数，需要根据具体的需求和应用场景进行权衡。

例如，以下命令中的"-preset fast"参数指定了编码速度较快，编码质量适中的参数：

```cmd
ffmpeg -i input.mp4 -c:v libx264 -preset fast -b:v 1M -c:a copy output.mp4
```

在这个命令中，"-i"参数用于指定输入文件"input.mp4"，**"-c:v"参数用于指定视频编码器为"libx264"，"-preset"参数用于指定编码速度和质量之间的平衡参数为"fast"，"-b:v"参数用于指定视频流的码率为1M，"-c:a"参数用于直接拷贝音频流**。最后，输出文件保存为"output.mp4"。

需要注意的是，"-preset"参数只是影响编码速度和质量之间的平衡关系，具体的编码效果还需要根据其他参数进行调整和优化。在实际使用中，需要结合具体的应用场景和需求来选择合适的"-preset"参数和其他编码参数。

> `-preset ultrafast` 和 `-preset placebo` 是在使用 FFmpeg 进行视频编码时的预设参数。这些预设参数用于控制编码速度和压缩效率之间的权衡。
>
> 1. `-preset ultrafast`: 这是一个编码速度优先的预设参数。使用此预设参数可以快速完成编码过程，但可能会导致视频质量较低和较大的文件大小。适用于需要快速编码的场景，如实时流传输或测试目的。
> 2. `-preset placebo`: 这是一个编码质量优先的预设参数。使用此预设参数可以获得最高质量的视频输出，但编码速度非常慢，需要更长的时间来完成编码。适用于对视频质量要求极高的场景，如专业视频制作或存档目的。
>
> 这些预设参数是 FFmpeg 中提供的一组预定义选项，可以根据具体需求选择合适的预设参数。除了 ultrafast 和 placebo 外，还有其他预设参数可供选择，例如 veryfast、fast、slow 等，用于在编码速度和质量之间进行平衡。





#### -c copy

在FFmpeg中，"-copy"参数**用于指定复制某个流，不进行编码处理，直接将该流复制到输出文件中，从而节省编码的时间和计算资源，同时保持原始数据的质量**。"-copy"参数也可以写成"-c copy"。

具体地说，"-c copy"参数可以用于音视频编解码中的多个场景，例如：

1.复制音频流或视频流：如果输入文件中已经包含了需要的音频流或视频流，可以使用"-c copy"参数直接将该流复制到输出文件中，而无需进行任何编码处理。例如，以下命令将输入文件中的音频流直接复制到输出文件中：

```cmd
ffmpeg -i input.mp4 -c:a copy output.mp4
```

在这个命令中，"-i"参数用于指定输入文件"input.mp4"，"-c:a"参数用于指定音频编码器为复制（即不进行编码处理），"-copy"参数用于复制音频流到输出文件中，最后输出文件保存为"output.mp4"。

2.复制字幕流：如果输入文件中包含了字幕流，可以使用"-c copy"参数将该字幕流复制到输出文件中。例如，以下命令将输入文件中的字幕流复制到输出文件中：

```cmd
ffmpeg -i input.mp4 -c:s copy output.mp4
```

在这个命令中，"-i"参数用于指定输入文件"input.mp4"，"-c:s"参数用于指定字幕编码器为复制（即不进行编码处理），"-copy"参数用于复制字幕流到输出文件中，最后输出文件保存为"output.mp4"。

需要注意的是，"-c copy"参数**只能用于将某一种流复制到输出文件中，而无法进行流的混合或转换**，如果需要对流进行混合或转换，需要使用其他编码器和参数进行处理。





#### -acodec copy

1. `-acodec copy`用于复制音频流，即将源文件中的音频流直接复制到输出文件中，不进行任何编码或转码操作。

2. 这个选项只适用于音频流，而不会对视频流进行任何处理。

   示例：

   ```cmd
   ffmpeg -i input.mp4 -acodec copy -vcodec <video_codec> output.mp4
   ```





#### -vcodec copy

1. `-vcodec copy`用于复制视频流，即将源文件中的视频流直接复制到输出文件中，不进行任何编码或转码操作。

2. 这个选项只适用于视频流，而不会对音频流进行任何处理。

   示例：

   ```cmd
   ffmpeg -i input.mp4 -vcodec copy -acodec <audio_codec> output.mp4
   ```

   



#### -ss

在FFmpeg中，"-ss"  参数表示**跳过输入文件的指定时间，从指定时间开始进行处理**。具体来说，它用于指定从哪个时间点开始剪辑或处理视频，其后面跟着一个时间戳参数，格式为"hh:mm:ss"或"ss"。

例如，如果需要从一个视频文件的 1 分 30 秒处开始剪辑，则可以使用以下命令：

```cmd
ffmpeg -i input.mp4 -ss 00:01:30 -c copy output.mp4
```

在这个命令中，"-i" 参数用于指定输入文件 "input.mp4"，"-ss" 参数用于指定从 1 分 30 秒的位置开始剪辑，"-c copy" 参数用于将剪辑后的视频流复制到输出文件中，最后输出文件保存为 "output.mp4"。

需要注意的是，"-ss" 参数一般必须放在 "-i" 参数之前，否则可能会导致剪辑不准确或处理失败(上面这个例子就不太好！)。另外，由于视频的编码方式不同，对于一些编码方式，" -ss" 参数可能会不够精确，因此需要结合其他参数一起使用。

> 注：
>
> 如果 "-ss" 参数放在 "-i" 参数之后，FFmpeg 会先读取完整的输入文件，然后再跳转到指定时间戳进行处理。这可能会导致剪辑不准确或处理失败，原因如下：
>
> 1. FFmpeg 需要先读取完整的输入文件才能确定指定时间戳的准确位置，这可能会导致处理速度变慢，尤其是对于大型视频文件来说。
> 2. 如果输入文件中包含多个视频流或音频流，则 FFmpeg 可能会选择错误的流进行处理，导致输出的结果不准确。
> 3. 如果输入文件的编码方式不支持随机访问或时间戳不准确，FFmpeg 可能无法准确跳转到指定时间戳，导致处理失败或输出的结果不准确。
>
> 因此，为了确保剪辑的准确性和处理效率，建议将 "-ss" 参数放在 "-i" 参数之前，这样 FFmpeg 就可以在读取输入文件时根据指定时间戳进行处理，避免了上述问题。



#### -vframe

在 FFmpeg 中，参数 `-vframes` 用于指定从视频中提取的帧数。它允许你设置提取的帧数的数量。

在之前的示例命令中，我们使用了 `-vframes 1` 来只提取一帧。这意味着从视频中仅提取一帧，并将其保存为输出文件。

如果你想提取多帧，只需将 `-vframes` 后面的数字更改为你想要的帧数。例如，要提取五帧，你可以使用 `-vframes 5`。这样会从视频中提取五帧，并将它们保存为输出文件的图片序列。

以下是使用FFmpeg命令行工具从视频中提取一帧并转换为BMP格式的示例命令：

```bash
ffmpeg -i input_video.mp4 -ss 00:00:05 -vframes 1 -f image2 output_frame.bmp
```

解释：

- `-i input_video.mp4`：指定输入视频文件。
- `-ss 00:00:05`：指定从视频中提取帧的时间点，此处为5秒，可以根据需要调整。
- `-vframes 1`：指定只提取一帧。
- `-f image2`：指定输出格式为图片序列，这里设置为BMP格式。
- `output_frame.bmp`：指定输出帧的文件名。

执行该命令后，FFmpeg将从输入视频中提取一帧，并将其保存为output_frame.bmp文件。请确保在使用之前已经安装了FFmpeg并且其在系统的环境变量中可用。



#### -t

在 FFmpeg 中，"-t" 参数用于**指定输出文件的时长或持续时间，即从输入文件中截取的时间长度。**

具体来说，"-t" 参数后面可以接一个以秒为单位的时间值，表示要从输入文件中截取的持续时间。例如：

```cmd
ffmpeg -i input.mp4 -t 10 output.mp4
```

上述命令表示从输入文件 "input.mp4" 中截取 10 秒钟的视频，并将结果保存为输出文件 "output.mp4"。



此外，"-t" 参数还可以与 "-ss" 参数一起使用，用于指定要截取的视频片段的起始时间和持续时间。例如：

```cmd
ffmpeg -i input.mp4 -ss 00:01:30 -t 10 output.mp4
```

上述命令表示从输入文件 "input.mp4" 中从第 1 分 30 秒开始截取 10 秒钟的视频，并将结果保存为输出文件 "output.mp4"。





#### -to

在 FFmpeg 中，"-to" 参数与 "-t" 参数类似，用于**指定输出文件的结束时间或持续时间**，即截取视频时结束的时间点。

具体来说，"-to" 参数后面可以接一个以秒为单位的时间值，表示要从输入文件中截取的持续时间，或者接一个时间戳，表示要从输入文件中截取到的结束时间点。例如：

```cmd
ffmpeg -i input.mp4 -to 00:01:30 output.mp4
```

上述命令表示从输入文件 "input.mp4" 中截取从开头到第 1 分 30 秒的视频，并将结果保存为输出文件 "output.mp4"。

需要注意的是，如果同时使用了 "-t" 和 "-to" 参数，FFmpeg 会以较小的值为准，即**以两者中最小的时间值为输出时长**。





#### -vn

在 FFmpeg 中，-vn 参数表示**只处理音频流，而不处理视频流**。**-vn 这个参数名中的 "vn" 其实是 "video null" 的缩写**，表示要禁用视频流。在处理视频文件时，FFmpeg 默认会处理视频和音频流。如果不使用 -vn 参数，FFmpeg 会将视频和音频流都处理完之后输出到目标文件中，这会导致生成的文件包含视频和音频两部分内容。

使用 -vn 参数可以让 FFmpeg 只处理音频流，从而**分离出视频文件中的音频部分**。这对于一些需要提取音频流的应用场景非常有用，例如从视频文件中提取音频进行处理、制作音频文件等等。

需要注意的是，-vn 参数只能用于分离音频流，无法用于分离视频流。如果需要分离视频流，可以使用类似 -an 参数来忽略音频流，只处理视频流。





#### -an

与`-vn` 同理咯





#### -map

在 FFmpeg 中，使用FFmpeg处理多媒体文件时 `-map` 参数来**选择从输入文件中复制哪些流并将它们写入输出文件**。通常在一个输入文件中会包含多个音频流、视频流、字幕流等不同类型的流，而输出文件中可能只需要其中的一部分流，或者需要对不同的流进行重编码等处理。

`-map`参数的基本语法为`-map [input_file_index]:[stream_specifier]`，其中`input_file_index`指定输入文件的**索引**，`stream_specifier`指定要复制或操作的**流的类型和索引**。例如，`-map 0:0`表示从第一个输入文件中选择第一个流，即第一个视频流；`-map 0:1`表示从第一个输入文件中选择第二个流，即第一个音频流。在`stream_specifier`中，常用的标识符包括`v`表示视频流，`a`表示音频流，`s`表示字幕流，数字表示具体的流索引等。

除了基本语法之外，`-map`参数还支持一些特殊的标识符，如`-map 0:a`表示从**第一个输入文件中选择所有的音频流**，`-map -0:v`表示**从所有输入文件中排除所有的视频流**等。





#### -tune

`-tune` 是FFmpeg中的一个选项，用于指定编码器的预设参数。它可以根据不同的应用场景和需求选择合适的预设参数，以优化编码质量、速度或特定的编码特性。

使用 `-tune` 选项可以提供以下预设参数：

1. `film`: 适用于电影内容的编码，注重编码质量。
2. `animation`: 适用于动画内容的编码，注重提供更好的动画压缩效果。
3. `grain`: 适用于具有颗粒状噪声的内容的编码，可以保留细节和噪声。
4. `stillimage`: 适用于静态图像内容的编码，注重保留图像细节。
5. `fastdecode`: 适用于快速解码的编码，可以加快解码速度。
6. `zerolatency`: 适用于实时传输场景的编码，尽量减小编码延迟。
7. `psnr`: 优化编码器以最大程度地提高峰值信噪比（PSNR）。

每个预设参数都针对特定的编码目标进行了优化，具体的效果和表现取决于输入内容、编码器以及其他相关参数的设置。

使用 `-tune` 选项时，可以根据实际需求选择合适的预设参数，以获得所需的编码效果。

> eg.：
>
> `-tune zerolatency` 是FFmpeg中的一个选项，用于优化编码设置以实现零延迟的实时传输。该选项适用于实时流媒体应用，例如视频会议、直播和实时监控等场景。
>
> 使用 `-tune zerolatency` 可以在一定程度上减少编码延迟，提高传输的实时性。它会对编码参数进行调整，以减小编码缓冲区的大小和延迟。具体来说，它可能会采取以下一些策略：
>
> 1. 减小GOP (Group of Pictures) 大小：GOP是一组连续的视频帧，减小GOP大小可以减小编码延迟，但也可能导致压缩效率和视频质量的降低。
> 2. 降低B帧的使用：B帧是一种参考两个关键帧之间的帧，减少B帧的使用可以减小编码延迟。
> 3. 使用较小的量化参数：量化参数的增加可以降低编码延迟，但也可能导致视频质量的降低。
> 4. 禁用某些编码优化：某些编码优化可能会引入额外的延迟，禁用这些优化可以减小编码延迟。
>
> 值得注意的是，使用 `-tune zerolatency` 可以降低编码延迟，但并不能完全实现零延迟，实际的延迟取决于多个因素，包括编码器设置、视频帧率、分辨率和编码质量等。
>
> 因此，在实时传输场景中，如果需要更低的编码延迟，可以尝试使用 `-tune zerolatency` 选项，并根据实际需求进行进一步调整和优化。



### 常用命令

#### 图片镜像

```cmd
ffmpeg -i input.jpg -vf hflip output.jpg
```

其中，`-i input.jpg` 指定输入图片文件路径为 `input.jpg`，`-vf hflip` 指定进行水平镜像操作，`output.jpg` 指定输出图片文件路径为 `output.jpg`。

如果需要进行垂直镜像操作，可以将 `-vf hflip` 替换为 `-vf vflip`。





#### 帧效果查看

```cmd
FFmpegStudy>ffplay -flags2 +export_mvs "[UHA-WINGS][Koi wa Ameagari no You ni][01][x264 1080p][GB].mp4" -vf codecview=mv=pf+bf+bb
```

使用 FFplay 工具来播放指定的 MP4 视频文件，并添加了 codecview 滤镜，通过设置 mv 参数可以显示每个宏块的运动矢量信息。

具体含义如下：

- `ffplay`：使用 FFplay 工具来播放视频
- `-flags2 +export_mvs`：启用 export_mvs 标志，允许输出每个宏块的运动矢量信息
- `"[UHA-WINGS][Koi wa Ameagari no You ni][01][x264 1080p][GB].mp4"`：指定要播放的 MP4 视频文件路径
- `-vf codecview=mv=pf`：添加 codecview 滤镜，并设置参数 mv=pf，以显示每个宏块的运动矢量信息。其中，mv 表示要显示运动矢量信息
- `pf`：在运动矢量图像上显示帧间预测（P帧）的矢量。
- `bf`：在运动矢量图像上显示前向预测帧（B帧）的矢量。
- `bb`：在运动矢量图像上显示双向预测帧（B帧）的矢量。





#### 切片（segment）

```cmd
ffmpeg -re -i input.mp4 -c copy -f segment -segment_format mp4 -segment_time 60 -segment_list_type m3u8 -segment_list output.m3u8 test_output-%d.mp4
```

该命令的功能是将输入的input.mp4文件**按照时长分割成若干个输出文件**test_output-1.mp4、test_output-2.mp4、test_output-3.mp4等，每个输出文件的时长是由-segment_time参数指定的，该参数的默认值为2秒。同时，由于-c copy参数的存在，输出文件的编码格式与输入文件相同，即不做重新编码处理，其次，-segment_format参数指定输出文件的格式为mp4。最后，-segment_list_type m3u8 -segment_list 生成指定的m3u8文件。

参数具体解释：

> - -re：以实时模式读取输入文件
> - -i input.mp4：输入文件为input.mp4
> - -c copy：进行复制编码，不对音视频进行重新编码，保留原有的编码格式和参数
> - -f segment：将输入流分割成多个输出段，每个输出段的时长由-segment_time参数决定
> - -segment_format mp4：指定输出段的格式为mp4格式
> - -segment_list_type m3u8：指定生成切片列表文档，文档格式为m3u8
> - segment_list output.m3u8：指定生成文档名为 output.m3u8（当然也可以指定为其他格式，诸如csv，flat等）
> - test_output-%d.mp4：输出文件的文件名格式，其中%d表示输出文件的序号，从1开始递增，每个输出段的时长由-segment_time参数决定。



注：使用-segment_time指定每60s进行一次切片时，并不能保证每个切片的时长都完全是60秒，因为ffmpeg默认在关键帧处进行切片，如果60秒的时长内没有关键帧，那么就会一直等到出现关键帧后再进行切片，所以可能会出现某些切片时长略短或略长的情况。这在对有长时间相同场景的音视频进行默认为2秒切片时，会特别明显，有些段会10多秒甚至更多，也有就1秒的。



#### 切片（-ss -t）

```cmd
ffmpeg -i "[UHA-WINGS][Koi wa Ameagari no You ni][01][x264 1080p][GB].mp4" -ss 5 -c copy -t 10 output_sst.mp4
```

将输入文件 "[UHA-WINGS] [Koi wa Ameagari no You ni] [01] [x264 1080p] [GB].mp4" 从第 5 秒的位置开始，复制 10 秒的内容，保存到输出文件 "output_sst.mp4" 中。

以下是每个参数的解释：

- `-i`：指定输入文件名。
- `"[UHA-WINGS][Koi wa Ameagari no You ni][01][x264 1080p][GB].mp4"`：输入文件名。
- `-ss 5`：从第 5 秒的位置开始。
- `-c copy`：使用“copy”编解码器，将输入文件中的音视频数据直接复制到输出文件中，以保持编码格式不变。
- `-t 10`：设置输出文件的持续时间为 10 秒。
- `output_sst.mp4`：输出文件名。





#### 音视频拆分

```cmd
ffmpeg -i "[UHA-WINGS][Koi wa Ameagari no You ni][01][x264 1080p][GB].mp4" -c:a copy -vn outputAudio.aac
```

将输入文件 "[UHA-WINGS] [Koi wa Ameagari no You ni] [01] [x264 1080p] [GB].mp4" 中的音频流提取出来，再将提取出来的音频流复制到输出文件 outputAudio.aac 中，而视频流则被丢弃。

具体的参数含义如下：

- `-i`：指定输入文件名；
- `-c:a`：指定要对音频流进行操作，这里表示对音频进行编码/解码（缺失参数）；
- `copy`：表示使用与输入流相同的编码格式，不进行编码，直接将输入流复制到输出文件；
- `-vn`：表示禁用视频流，不进行视频流的处理；
- `outputAudio.aac`：指定输出文件名为 outputAudio.aac。

因此，该命令的作用是提取输入文件中的音频流，直接将其复制到输出文件中，输出文件的格式为 AAC，视频流将被忽略。



```cmd
ffmpeg -i "[UHA-WINGS][Koi wa Ameagari no You ni][01][x264 1080p][GB].mp4" -c:v copy -an outputVideo.mp4
```

将输入文件 "[UHA-WINGS] [Koi wa Ameagari no You ni] [01] [x264 1080p] [GB].mp4" 中的视频流提取出来，再将提取出来的视频流复制到输出文件 outputVideo.mp4 中，而音频流则被丢弃。

具体的参数含义如下：

- `-i`：指定输入文件名；
- `-c:v`：指定要对音频流进行操作，这里表示对视频进行编码/解码（缺失参数）；
- `copy`：表示使用与输入流相同的编码格式，不进行编码，直接将输入流复制到输出文件；
- `-an`：表示禁用音频流，不进行音频的处理；
- `outputVideo.mp4`：指定输出文件名为 outputVideo.mp4。

因此，该命令的作用是提取输入文件中的视频流，直接将其复制到输出文件中，输出文件的格式为mp4，音频流将被忽略。





#### 抽帧

```cmd
ffmpeg -i input.mp4 -vf fps=10 out%d.jpg
```

该命令使用FFmpeg工具，将输入文件 input.mp4 的视频流以每秒10帧的速率抽取帧，并将抽取的每一帧保存为输出文件 out%d.jpg（%d 会被自动替换为数字序列）。

具体参数的作用如下：

- -i：指定输入文件名。
- -vf：指定视频滤镜，这里使用 fps=10 指定抽取帧的速率为**10帧/秒**。
- out%d.jpg：指定输出文件名，其中 %d 表示数字序列，会按照顺序递增，例如 out1.jpg、out2.jpg 等。



#### 音频编码质量

##### mp3

```cmd
ffmpeg -i outAnimal.mp3 -c:a libmp3lame -q:a 0 outAnimalMax.mp3
```

将输入音频文件 outAnimal.mp3 进行重新编码，转换为 MP3 格式的音频文件 outAnimalMax.mp3，同时对转码后的音频使用最高品质（音频质量系数为 0）进行编码。

各参数的意义如下：

- `-i outAnimal.mp3`：指定输入文件为 outAnimal.mp3。
- `-c:a libmp3lame`：设置音频编码器为 libmp3lame，即使用 LAME MP3 编码器对音频进行编码。
- `-q:a 0`：设置音频质量系数为 0，即使用最高音质对音频进行编码，生成的 MP3 文件质量最高。如果该参数设置为 2，则音频质量会有所降低，但生成的文件大小会更小。


## 音视频编解码

### 音视频解码

#### ffmpeg音视频解码流程参考

![](https://github.com/drizzledrop3/audio-video-learning/blob/main/IMG/AudioVideo/ffmpeg1.png)



#### ffmpeg音视频播放流程参考(windows)

![](https://github.com/drizzledrop3/audio-video-learning/blob/main/IMG/AudioVideo/ffmpeg2.png)



### 音视频编码

#### ffmpeg视频编码YUV参考

![](https://github.com/drizzledrop3/audio-video-learning/blob/main/IMG/AudioVideo/ffmpeg3.png)



#### ffmpeg音频编码PCM参考

![](https://github.com/drizzledrop3/audio-video-learning/blob/main/IMG/AudioVideo/ffmpeg4.png)


