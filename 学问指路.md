# 学问指路

## 视频如何通过视频编码再到视频格式封装的

视频编码是**将原始视频信号转换成数字信号**，并**通过压缩算法来减少数据量**，以便于存储和传输。常见的视频编码标准包括H.264、H.265、MPEG-2等。

在视频编码完成后，需要**将编码后的视频信号打包成特定的格式**，即视频封装格式。视频封装格式通常包括了**音频、视频、字幕、章节**等多个流的封装，以便于**在播放时同时进行多个流的同步播放**。常见的视频封装格式包括AVI、MKV、MP4、MOV等。

在视频编码之前，需要对视频进行采集和处理。视频采集通常是通过摄像头或其他视频设备将原始视频信号转换成数字信号。视频处理则包括对视频进行**去噪、颜色校正、降低码率**等操作，以便于视频编码器对视频进行压缩。

总的来说，视频编码和视频格式封装是视频处理和传输的重要组成部分。视频编码负责将原始视频信号压缩为较小的数据量，而视频格式封装则将编码后的视频流打包为特定的格式，以便于存储和传输。



## 一般进行录像生成的视频，也是上述流程吗

是的，一般进行录像生成的视频也会经历类似的流程。在录制视频时，摄像机或手机摄像头等设备会对视频进行采集和压缩编码，得到视频的编码数据。这些编码数据需要根据特定的封装格式进行打包，包含视频的音频、字幕、章节信息等元数据，形成最终的视频文件。不同的设备和应用程序可能会使用不同的视频编码器和封装格式，但是视频的基本处理流程是相似的。



## m3u8到底是什么格式

### **视频播放的过程**

现在的视频网站采用的是流媒体传输协议，就是将一段视频切成无数个小段，这几个小段就是ts格式的视频文件，一段一段的网站上播放。

这样做的好处是观看更加流畅，因为他会根据网络状况自动切换视频的清晰度，在网络状况不稳定的情况下，对保障流畅播放非常有帮助。

我们可以了解下，一个视频播放的全过程。

> 1.服务器采集编码传输视频到切片器
> 2.切片器对视频创建**索引文件，**并且**切割**成**n个ts文件**
> 3.这2个文件传输到http服务器上
> 4.网站/客户端根据**索引文件**查找http服务器上的**ts文件**，连续播放这n个ts文件，就可以了。

给大家画了下流程图



![img](https://pic4.zhimg.com/80/v2-53bdb5ade54140de034973bc1bb0a38f_1440w.webp)



所以我们可以知道，索引文件非常重要，索引文件里面存储着ts文件的网络url链接，网站需要拿到索引文件，去按照url链接下载在http服务器中的ts文件，类似于爬虫。

拿到了ts文件之后，本身这些ts文件就是原视频中的一小段视频，所有ts文件下载顺序播放，就完成了整个视频的播放。

而索引文件就是m3u8文件。

现在大部分视频网站传输都是采用这种方法，所以，也就是说，如果你在观看网页视频的时候，能够弄到加载该视频的m3u8文件，那么再配合一些工具，就能下载该视频了。

该工具的作用就类似于视频网站,能够根据索引文件去下载ts文件。

更具体的耍耍m3u8文件，可参考 [【全网最全】m3u8到底是什么格式？一篇文章搞定m3u8下载](https://zhuanlan.zhihu.com/p/346683119)





### 为什么有无损音频格式而没有无损视频压缩格式

刻意追求无损就是不讲科学的人为了求个心理安慰。

立论：视频和音频都是人类欺骗自己感官的一种手段。

一段五秒钟的视频或者音频，有可能占多大的存储空间？

答案是要多大有多大，因为这是由你的**采样质量**和**采样频率**共同决定的。

对声音和动画，不存在无损的保留。

更详细可见：[为什么有无损音频格式而没有无损视频压缩格式？](https://www.zhihu.com/question/27889429)





## 码流

码流（Bitstream）指的是一段**二进制数据流**，它包含了被编码后的数字信号，例如视频、音频、图像等等。在数字通信、数字媒体、计算机网络和信息安全等领域中，码流是一个很重要的概念。

在视频和音频领域，码流通常是通过视频编码和音频编码技术将视频和音频信号压缩成数字信号的一种形式。码流中的每一个二进制数据都代表着一些具体的信息，例如视频中的像素信息、色彩信息、帧率、码率等等，音频中的采样率、采样位数、声道数、码率等等。码流的数据量一般是通过码率来描述的，单位通常是每秒的比特数（bps）或千比特数（Kbps）。

码流的应用非常广泛，例如视频传输、视频会议、流媒体、网络广播、数字电视等等，**码流的质量和稳定性对于实时传输和播放的效果有很大的影响**。因此，在处理和传输码流时，需要注意信号的带宽、延迟、抖动等问题，以保证码流的正确性和稳定性。





### 码流和码率的区别

码流和码率在某些情况下可以视为相同的概念，但它们**并不完全等同**。

简单来说，码流（Bitstream）是指一段连续的二进制数据流，包含了被编码后的数字信号，例如音频、视频、图像等等。而码率（Bitrate）则是指每秒钟传输的比特数，也可以理解为**码流的传输速率**。码率是码流传输中一个非常重要的指标，通常用于描述一个视频或音频流的传输速率和质量。

例如，一部高清视频文件的码流是20Mbps，这个码流中包含了视频和音频信号的所有信息。如果该视频的播放时间为1小时，则其对应的码率为：

20Mbps / 8 bits/byte = 2.5MB/s 
2.5MB/s * 60s/min * 60min/hour = 9GB/hour

这意味着，该视频在播放期间每小时会传输9GB的数据量，这个码率越高，代表传输速率越快，同时也意味着需要更大的带宽和存储空间来传输和保存这个码流。因此，在实际应用中，需要根据具体的场景和要求来控制码率的大小，以达到最优的传输效果。





## 视频压缩比

视频压缩比（Compression Ratio）是指**在压缩前后视频文件的大小比例**。具体来说，它是指压缩前的视频文件大小与压缩后文件大小的比值，通常用百分比表示。

例如，如果一个视频文件的原始大小为500MB，经过压缩后，文件大小缩小到了100MB，则该视频的压缩比为：

**压缩比 = 原始文件大小 / 压缩后文件大小** = 500MB / 100MB = 5:1

因此，该视频的压缩比为5:1，也就是说，压缩后的文件大小只有原始文件大小的五分之一。在实际应用中，视频压缩比通常越高，代表压缩效果越好，同时也意味着压缩后的文件大小更小，传输和存储成本更低。

然而，需要注意的是，视频压缩比并不是越大越好或越小越好。如果压缩比太高，会导致视频质量严重下降，出现模糊、失真、花屏等问题，影响观感和应用效果。因此，在实际应用中，需要根据具体的场景和需求来平衡视频压缩比和视频质量，以达到最优的压缩效果。





## 多码流技术

多码流技术指的是在视频压缩编码的过程中，**同时产生多个不同码率、分辨率或编码质量的视频流**。这些流可以在不同的网络环境下进行自适应码流调节，以保证视频在不同的网络条件下的播放质量和稳定性。这一技术被广泛应用于网络直播、视频点播等多媒体传输领域。

在多码流技术中，主要有以下几种类型的码流：

1. 分辨率码流：以不同的分辨率为区分，如标清、高清等。
2. 码率码流：以不同的码率为区分，常用于网络直播中。低码率适用于网络条件较差的情况，而高码率则适用于网络条件较好的情况。
3. 画质码流：以不同的画质为区分，常用于视频点播和网络直播中。通过在不同的画质和帧率之间自适应调节，可以在不影响视频质量的情况下提高视频播放效率。

通过多码流技术，视频传输可以更好地适应不同的网络环境，保证视频播放的质量和稳定性，提高用户的观看体验。